$(function(){function timeCheck(t){var a=""==$("#startTime").val()?$("#startTime").val():$("#startTime").val()+" 00:00:00",e=""==$("#endTime").val()?$("#endTime").val():$("#endTime").val()+" 23:59:59";if(""!=a&&""!=e)for(var i=$("#startTime").val().split("-"),l=$("#endTime").val().split("-"),n=0;n<i.length;n++){if(i[n]=parseInt(i[n]),l[n]=parseInt(l[n]),i[n]<l[n]){console.log(11),t(a,e);break}i[n]>l[n]?(console.log(22),alert("时间输入错误，请重新输入"),$("#startTime").val(""),$("#endTime").val("")):2==n&&(console.log(33),t(a,e))}else""!=a&&""==e?t(a,e=getDate()):alert("请输入时间")}function sendData(t,a){$("#setTime").css("display","none"),$("#wechat").css("display","block"),$("#showWaiting").css("display","block"),$.ajax({url:"MPShow/show",type:"post",dataType:"json",data:{startTime:t,endTime:a},success:function(t){$("#showWaiting").css("display","none"),lineArray(t),setColor()},error:function(){console.log("数据传输出错了！！")}})}function createTable(t){for(var a=0;a<t.length;a++){var e="";e+="<tr>",e+="<td rowspan='6'>"+t[a].line+"</td>",e+="</tr>",e+="<tr>",e+="<td></td>",e+="<td>成功率</td>",e+="<td>失败率</td>",e+="</tr>",e+="<tr>",e+="<td>上料</td>",e+="<td>"+t[a].feedSuc+"</td>",e+="<td>"+t[a].feedFail+"</td>",e+="</tr>",e+="<tr>",e+="<td>换料</td>",e+="<td>"+t[a].changeSuc+"</td>",e+="<td>"+t[a].changeFail+"</td>",e+="</tr>",e+="<tr>",e+="<td>抽检</td>",e+="<td>"+t[a].someSuc+"</td>",e+="<td>"+t[a].someFail+"</td>",e+="</tr>",e+="<tr>",e+="<td>全检</td>",e+="<td>"+t[a].allsSuc+"</td>",e+="<td>"+t[a].allsFail+"</td>",e+="</tr>",$("#wechat_tbody").append(e)}}function lineArray(data){for(var arr=[],i=0;i<data.length;i++)if(0==arr.length)""!=data[i].line&&(arr.push(data[i].line),eval("var $"+data[i].line+" = []"),eval("$"+data[i].line).push(data[i]),createTable(eval("$"+data[i].line)));else{for(var j=0;j<arr.length&&data[i].line!=arr[j];j++);""!=data[i].line&&(arr.push(data[i].line),eval("var $"+data[i].line+" = []"),eval("$"+data[i].line).push(data[i]),createTable(eval("$"+data[i].line)))}}function setColor(){for(var t=$("#wechat_tbody tr"),a=parseInt(t.length/6),e=0;e<a;e++)for(var i=1;i<6;i++)$(t[i+6*e].children[1]).css("color","green"),$(t[i+6*e].children[2]).css("color","red")}function getDate(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" 23:59:59"}$("#showWaiting").css("display","none"),$("#btn_search").on("click",function(){$("#wechat_tbody").empty(),timeCheck(sendData)}),$("#back").on("click",function(){$("#setTime").css("display","block"),$("#wechat").css("display","none")})});